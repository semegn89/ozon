# Диагностика проблем с ботом

## Проблема: "Модель не найдена!"

### Симптомы:
- Модель добавляется через админ-панель
- При нажатии на модель появляется сообщение "Модель не найдена!"
- Модель не отображается с опциями (инструкции, скачать документы и т.д.)

### Возможные причины:

1. **Проблема с базой данных**
   - Модель не сохраняется в базе данных
   - Проблема с транзакциями
   - Неправильная конфигурация базы данных

2. **Проблема с ID модели**
   - Неправильный ID передается в callback_data
   - Проблема с парсингом callback_data

3. **Проблема с сессией базы данных**
   - Сессия закрывается до завершения операции
   - Проблема с подключением к базе данных

### Диагностика:

#### 1. Проверка базы данных
```bash
python check_db.py
```

#### 2. Диагностика моделей
```bash
python debug_models.py
```

#### 3. Проверка логов бота
В Railway Dashboard → Logs ищите сообщения:
- "Creating model: name='...', description='...', tags='...'"
- "Model created successfully: ID=..., name='...'"
- "Model button clicked: callback_data='...', model_id=..."
- "Looking for model with ID: ..."
- "Model found: ID=..., name='...'" или "Model not found with ID: ..."

### Решения:

#### Если модель не сохраняется:
1. Проверьте права доступа к базе данных
2. Убедитесь, что транзакции коммитятся
3. Проверьте конфигурацию DB_URL

#### Если модель не находится по ID:
1. Проверьте, что ID передается правильно
2. Убедитесь, что callback_data парсится корректно
3. Проверьте, что сессия базы данных активна

#### Если проблема с Railway:
1. Перезапустите бота
2. Проверьте переменные окружения
3. Убедитесь, что база данных доступна

### Отладка:

Добавлены отладочные логи в:
- `handle_admin_add_model_tags()` - создание модели
- `handle_model_selected()` - выбор модели
- `handle_choose_model()` - список моделей
- `button_callback()` - обработка кнопок

### Следующие шаги:

1. Запустите диагностические скрипты
2. Проверьте логи в Railway
3. Попробуйте добавить модель снова
4. Если проблема persists, проверьте конфигурацию базы данных

### Контакты:
Если проблема не решается, обратитесь к разработчику с логами из Railway Dashboard.
